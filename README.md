
main.dart
import 'package:bintangban/firebase_options.dart';
import 'package:bintangban/page/export_qr_page.dart';
import 'package:bintangban/page/home_page.dart';
import 'package:bintangban/page/input_kendaraan_baru_page.dart';
import 'package:bintangban/page/kendaraan_sudah_terdaftar.dart';
import 'package:bintangban/page/servis_page.dart';
import 'package:bintangban/page/tentang_kendaraan_page.dart';
import 'package:bintangban/page/tentang_kendaraan_web_page.dart';
import 'package:bintangban/provider/crystal_autos_provider.dart';
import 'package:bintangban/provider/servis_provider.dart';
import 'package:bintangban/provider/web_provider.dart';
import 'package:firebase_core/firebase_core.dart';
import 'package:flutter/foundation.dart' show kIsWeb;
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  final bintangbanProvider = BintangbanProvider();
  final servisProvider = ServisProvider();
  final webProvider = WebProvider();
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  runApp(
    kIsWeb
        ? MultiProvider(
            providers: [
              ChangeNotifierProvider(
                create: (_) => webProvider,
              ),
            ],
            child: const MyApp(),
          )
        : MultiProvider(
            providers: [
              ChangeNotifierProvider(
                create: (_) => bintangbanProvider,
              ),
              ChangeNotifierProvider(
                create: (_) => servisProvider,
              ),
            ],
            child: const MyApp(),
          ),
  );
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'CrystalAutowork Mobile App',
      theme: ThemeData(
        colorScheme: ColorScheme.fromSeed(seedColor: Colors.deepPurple),
        useMaterial3: true,
      ),
      // home: const HomePage(),
      initialRoute: kIsWeb ? '/tentangKendaraanWeb' : '/',
      routes: kIsWeb
          ? {
              '/tentangKendaraanWeb': (context) {
                return TentangKendaraanWebPage(
                    nomorPolisi: Uri.base.queryParameters['nomorPolisi']);
              },
            }
          : {
              '/': (_) => const HomePage(),
              '/inputKendaraanBaru': (_) => const KendaraanBelumTerdaftar(),
              '/servisPage': (_) => const ServisPage(),
              '/kendaraanSudahTerdaftar': (_) =>
                  const KendaraanSudahTerdaftarPage(),
              '/tentangKendaraan': (_) => const TentangKendaraanPage(),
            },
    );
  }
}


firebase_options.dart
// File generated by FlutterFire CLI.
// ignore_for_file: lines_longer_than_80_chars, avoid_classes_with_only_static_members
import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;
import 'package:flutter/foundation.dart'
    show defaultTargetPlatform, kIsWeb, TargetPlatform;

/// Default [FirebaseOptions] for use with your Firebase apps.
///
/// Example:
/// ```dart
/// import 'firebase_options.dart';
/// // ...
/// await Firebase.initializeApp(
///   options: DefaultFirebaseOptions.currentPlatform,
/// );
/// ```
class DefaultFirebaseOptions {
  static FirebaseOptions get currentPlatform {
    if (kIsWeb) {
      return web;
    }
    switch (defaultTargetPlatform) {
      case TargetPlatform.android:
        return android;
      case TargetPlatform.iOS:
        return ios;
      case TargetPlatform.macOS:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for macos - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      case TargetPlatform.windows:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for windows - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      case TargetPlatform.linux:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for linux - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      default:
        throw UnsupportedError(
          'DefaultFirebaseOptions are not supported for this platform.',
        );
    }
  }

  static const FirebaseOptions web = FirebaseOptions(
    apiKey: 'AIzaSyD347Uf7nmmtzc3zGyXfjWdJk3P6S9cEh4',
    appId: '1:713278578832:web:dfd3ff4b49802237387815',
    messagingSenderId: '713278578832',
    projectId: 'bintangban-56d57',
    authDomain: 'bintangban-56d57.firebaseapp.com',
    storageBucket: 'bintangban-56d57.appspot.com',
    measurementId: 'G-8XRM9NTJG1',
  );

  static const FirebaseOptions android = FirebaseOptions(
    apiKey: 'AIzaSyAdbTmYijmccTlsyii_iBsCxBt4xvihImM',
    appId: '1:713278578832:android:dedfffb942b69297387815',
    messagingSenderId: '713278578832',
    projectId: 'bintangban-56d57',
    storageBucket: 'bintangban-56d57.appspot.com',
  );

  static const FirebaseOptions ios = FirebaseOptions(
    apiKey: 'AIzaSyDYixm5_pUZgFCRxIXWolM_UOmDqE9hVuA',
    appId: '1:713278578832:ios:fc9cdf2ee8fdbcb1387815',
    messagingSenderId: '713278578832',
    projectId: 'bintangban-56d57',
    storageBucket: 'bintangban-56d57.appspot.com',
    iosBundleId: 'com.example.bintangban',
  );
}



models.dart

class Servis {
  String idServis;
  String tanggalServis;
  String catatanServis;
  List<PartServis> partServis;
  double totalNominalServis;
  String statusPaddServis;

  Servis({
    this.idServis = '',
    required this.tanggalServis,
    required this.catatanServis,
    required this.partServis,
    required this.totalNominalServis,
    required this.statusPaddServis,
  });

  factory Servis.fromMap(Map<String, dynamic> map, String id) {
    return Servis(
      idServis: id,
      tanggalServis: map['tanggalServis'] as String,
      catatanServis: map['catatanServis'] as String,
      partServis: (map['partServis'] as List)
          .map((e) => PartServis(
                namaItem: e['namaItem'],
                hargaItem: e['hargaItem'],
                catatanItem: e['catatanItem'],
              ))
          .toList(),
      totalNominalServis: map['totalNominalServis'] as double,
      statusPaddServis: map['statusPaddServis'] as String,
    );
  }
}

class Kendaraan {
  final String nomorPolisi;
  final String jenisKendaraan;
  final String tipeKendaraan;
  final String namaPemilik;

  Kendaraan(
      {required this.nomorPolisi,
      required this.jenisKendaraan,
      required this.tipeKendaraan,
      required this.namaPemilik});

  factory Kendaraan.fromMap(Map<String, dynamic> map, String id) {
    return Kendaraan(
      nomorPolisi: map['nomorPolisi'] as String,
      jenisKendaraan: map['jenisKendaraan'] as String,
      tipeKendaraan: map['tipeKendaraan'] as String,
      namaPemilik: map['namaPemilik'] as String,
    );
  }
}

class PartServis {
  String namaItem;
  double hargaItem;
  String catatanItem;

  PartServis({
    required this.namaItem,
    required this.hargaItem,
    required this.catatanItem,
  });

  Map<String, dynamic> toMap() {
    return {
      'namaItem': namaItem,
      'hargaItem': hargaItem,
      'catatanItem': catatanItem,
    };
  }
}



custom_styles.dart
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:google_fonts/google_fonts.dart';
import 'package:intl/intl.dart';

class CustomStyles {
  final Color? textColor;

  const CustomStyles({
    this.textColor,
  });

  static TextStyle appBarTextStyle({
    FontWeight fontWeight = FontWeight.w600,
    double fontSize = 18,
    Color? color, // Change Color to Color?
  }) {
    return GoogleFonts.inter(
      fontWeight: fontWeight,
      fontSize: fontSize,
      color: color ?? Colors.black, // Use provided color or default to black
    );
  }
}

class NumberFormatter {
  static String formatValue(int value) {
    return NumberFormat.decimalPattern().format(value.floor());
  }

  static String formatValueTwo(double value) {
    return NumberFormat.decimalPattern().format(value.floor());
  }
}

class CurrencyInputFormatter extends TextInputFormatter {
  @override
  TextEditingValue formatEditUpdate(
      TextEditingValue oldValue, TextEditingValue newValue) {
    if (newValue.text.isEmpty) {
      return newValue.copyWith(text: '');
    } else if (newValue.text.compareTo(oldValue.text) != 0) {
      final int selectionIndexFromTheRight =
          newValue.text.length - newValue.selection.end;
      final f = NumberFormat("#,##0", "id_ID");
      final number =
          int.parse(newValue.text.replaceAll(f.symbols.GROUP_SEP, ''));
      final newString = 'Rp. ' + f.format(number);
      return TextEditingValue(
        text: newString,
        selection: TextSelection.collapsed(
            offset: newString.length - selectionIndexFromTheRight),
      );
    } else {
      return newValue;
    }
  }
}


Bintangban_provider.dart
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:bintangban/models/data.dart';
import 'package:bintangban/services/firestore_services.dart';
import 'package:flutter/material.dart';

class BintangbanProvider extends ChangeNotifier {
  Kendaraan? kendaraanPengguna;
  List<Servis> listServisPengguna = [];
  bool _isLoading = true;
  String _nomorPolisi = '';

  bool get isLoading => _isLoading;
  String get nomorPolisi => _nomorPolisi;

  Future? getAllDataFuture;

  BintangbanProvider() {
    getAllDataFuture = getAllData();
  }

  Future<bool> getAllData() async {
    _isLoading = true;
    notifyListeners();
    try {
      var results = await Future.wait([
        getKendaraanByNomorPolisi(),
        getServisByNomorPolisi(),
      ]);
      _isLoading = false;
      notifyListeners();
      // If any of the futures returned false, return false. Otherwise, return true.
      return !results.contains(false);
    } catch (e) {
      _isLoading = false;
      notifyListeners();
      return false;
    }
  }

  void setNomorPolisi(String data) {
    _nomorPolisi = data;
    notifyListeners();
  }

  Future<bool> getKendaraanByNomorPolisi() async {
    try {
      QuerySnapshot querySnapshot =
          await FirestoreService().searchKendaraanByNomorPolisi(nomorPolisi);
      if (querySnapshot.docs.isEmpty) {
        print('Kendaraan tidak ditemukan');
        return false;
      } else {
        for (DocumentSnapshot doc in querySnapshot.docs) {
          var data = doc.data() as Map<String, dynamic>?;
          if (data != null) {
            Kendaraan kendaraan = Kendaraan.fromMap(data, doc.id);
            kendaraanPengguna = kendaraan;
            print('Nomor Polisi: ${kendaraan.nomorPolisi}');
            print('Nama Pemilik: ${kendaraan.namaPemilik}');
            notifyListeners();
          }
        }
        return true;
      }
    } catch (e) {
      print('Error searching and printing kendaraan by nomorPolisi: $e');
      return false;
    }
  }

  Future<bool> getKendaraanByNomorPolisiWeb(String nomorPolisi) async {
    setNomorPolisi(nomorPolisi);
    print('nomor polisi d provider : $nomorPolisi');
    try {
      QuerySnapshot querySnapshot =
          await FirestoreService().searchKendaraanByNomorPolisiWeb(nomorPolisi);
      if (querySnapshot.docs.isEmpty) {
        print('Kendaraan tidak ditemukan');
        return false;
      } else {
        for (QueryDocumentSnapshot doc in querySnapshot.docs) {
          var data = doc.data() as Map<String, dynamic>;
          if (data != null) {
            Kendaraan kendaraan = Kendaraan.fromMap(data, doc.id);
            kendaraanPengguna = kendaraan;
            print('Nomor Polisi: ${kendaraan.nomorPolisi}');
            print('Nama Pemilik: ${kendaraan.namaPemilik}');
            notifyListeners();
          }
        }
        return true;
      }
    } catch (e) {
      print('Error searching and printing kendaraan by nomorPolisi: $e');
      return false;
    }
  }

  Future<bool> getServisByNomorPolisi() async {
    listServisPengguna.clear(); // Clear the list before adding new items

    try {
      DocumentSnapshot doc = await FirebaseFirestore.instance
          .collection('servis')
          .doc(nomorPolisi)
          .get();
      if (!doc.exists) {
        print('Servis tidak ditemukan');
        return true;
      } else {
        var data = doc.data() as Map<String, dynamic>?;
        if (data != null) {
          data.forEach((key, value) {
            Servis servis = Servis.fromMap(value, key);
            listServisPengguna.add(servis); // Add the servis to the list
            notifyListeners();
          });
        }
        return true;
      }
    } catch (e) {
      print('Error searching and printing servis by nomorPolisi: $e');
      return true;
    }
  }
}




servis_provider.dart

import 'package:bintangban/models/data.dart';
import 'package:flutter/cupertino.dart';

class ServisProvider extends ChangeNotifier {
  List<PartServis> _partServisList = [];

  List<PartServis> get partServisList => _partServisList;

  void addPartServis(PartServis partServis) async {
    partServisList.add(partServis);
    notifyListeners();
  }

  void clearPartServisList() {
    _partServisList.clear();
    notifyListeners();
  }

  void removePartServisAt(int index) {
    _partServisList.removeAt(index);
    notifyListeners();
  }
}


web_provider.dart

import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:bintangban/models/data.dart';
import 'package:bintangban/services/firestore_services.dart';
import 'package:flutter/material.dart';

class WebProvider extends ChangeNotifier {
  Kendaraan? kendaraanPengguna;
  List<Servis> listServisPengguna = [];

  WebProvider() {
    // getAllDataFuture = getAllData();
  }

  Future<bool> getKendaraanByNomorPolisiWeb(String nomorPolisi) async {
    print('nomor polisi yg mau injek : $nomorPolisi');
    try {
      QuerySnapshot querySnapshot =
          await FirestoreService().searchKendaraanByNomorPolisiWeb(nomorPolisi);
      if (querySnapshot.docs.isEmpty) {
        print('Kendaraan tidak ditemukan');
        return false;
      } else {
        for (QueryDocumentSnapshot doc in querySnapshot.docs) {
          var data = doc.data() as Map<String, dynamic>;
          if (data != null) {
            Kendaraan kendaraan = Kendaraan.fromMap(data, doc.id);
            kendaraanPengguna = kendaraan;
            notifyListeners();
            print('Nomor Polisi: ${kendaraan.nomorPolisi}');
            print('Nama Pemilik: ${kendaraan.namaPemilik}');
          }
        }
        return true;
      }
    } catch (e) {
      print('Error searching and printing kendaraan by nomorPolisi: $e');
      return false;
    }
  }

  Future<bool> getServisByNomorPolisiWeb(String nomorPolisi) async {
    listServisPengguna.clear(); // Clear the list before adding new items

    try {
      DocumentSnapshot doc = await FirebaseFirestore.instance
          .collection('servis')
          .doc(nomorPolisi)
          .get();
      if (!doc.exists) {
        print('Servis tidak ditemukan');
        return true;
      } else {
        var data = doc.data() as Map<String, dynamic>?;
        if (data != null) {
          data.forEach((key, value) {
            Servis servis = Servis.fromMap(value, key);
            listServisPengguna.add(servis); // Add the servis to the list
            notifyListeners();
          });
        }
        return true;
      }
    } catch (e) {
      print('Error searching and printing servis by nomorPolisi: $e');
      return true;
    }
  }
}


export_qr_page.dart

import 'dart:io';
import 'package:bintangban/helper/custom_styles.dart';
import 'package:flutter/material.dart';
import 'package:fluttertoast/fluttertoast.dart';
import 'package:google_fonts/google_fonts.dart';
import 'package:path_provider/path_provider.dart';
import 'package:qr_flutter/qr_flutter.dart';
import 'package:image_gallery_saver/image_gallery_saver.dart';
import 'package:screenshot/screenshot.dart';
import 'package:share_plus/share_plus.dart';

class ExportQRPage extends StatefulWidget {
  final String url;

  const ExportQRPage({required this.url, super.key});

  @override
  State<ExportQRPage> createState() => _ExportQRPageState();
}

class _ExportQRPageState extends State<ExportQRPage> {
  late ScreenshotController screenshotController;

  @override
  void initState() {
    super.initState();
    screenshotController = ScreenshotController();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      persistentFooterButtons: [
        ElevatedButton(
          onPressed: () async {
            Fluttertoast.showToast(
                msg: 'QR tersimpan di gallery!',
                toastLength: Toast.LENGTH_SHORT,
                gravity: ToastGravity.BOTTOM,
                timeInSecForIosWeb: 1,
                fontSize: 16.0);
            String name = 'BintangbanQR_${DateTime.now().toIso8601String()}';
            // Save img to gallery
            await screenshotController
                .capture(delay: Duration(milliseconds: 10))
                .then((capturedImage) async {
              if (capturedImage != null) {
                final directory = await getApplicationDocumentsDirectory();
                final imagePath =
                    await File('${directory.path}/image.png').create();
                await imagePath.writeAsBytes(capturedImage);

                /// Share Plugin
                await Share.shareXFiles(
                  [XFile(imagePath.path)],
                  text: 'QR Kendaraan',
                  subject: 'QR Kendaraan Crystal Autos',
                );
                // await Share.shareFiles([imagePath.path]);
                await ImageGallerySaver.saveImage(capturedImage, name: name);
              }
            }).catchError((onError) {
              print(onError);
            });
          },
          child: Row(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              Center(
                child: Text(
                  'Simpan QR ke Galeri',
                  textAlign: TextAlign.center,
                  style: GoogleFonts.inter(fontWeight: FontWeight.w600),
                ),
              ),
            ],
          ),
        ),
      ],
      appBar: AppBar(
        title: Text(
          'QR Kendaraan Baru',
          style: CustomStyles.appBarTextStyle(),
        ),
        centerTitle: true,
      ),
      body: SafeArea(
        child: Padding(
            padding: const EdgeInsets.all(14.0),
            child: Column(
              children: [
                Screenshot(
                  controller: screenshotController,
                  child: CrystalQRImage(
                    url: widget.url,
                  ),
                ),
              ],
            )),
      ),
    );
  }
}

class CrystalQRImage extends StatelessWidget {
  const CrystalQRImage({
    super.key,
    required this.url,
  });

  final String url;

  @override
  Widget build(BuildContext context) {
    return Container(
      color: Colors.white,
      child: Center(
        child: Column(
          children: [
            Text(
              'Crystal Autowork System',
              style: GoogleFonts.inter(
                fontWeight: FontWeight.w600,
                fontSize: 18,
              ),
            ),
            Padding(
              padding: const EdgeInsets.all(8.0),
              child: SizedBox(
                height: 250,
                width: 250,
                child: QrImageView(data: url),
              ),
            ),
            Text(
              'Scan QR diatas untuk melihat riwayat servis',
              textAlign: TextAlign.center,
              style: GoogleFonts.inter(
                fontWeight: FontWeight.w400,
                fontSize: 16,
              ),
            ),
          ],
        ),
      ),
    );
  }
}




home_page.dart

import 'package:bintangban/page/input_kendaraan_baru_page.dart';
import 'package:bintangban/page/kendaraan_sudah_terdaftar.dart';
import 'package:flutter/material.dart';
import 'package:google_fonts/google_fonts.dart';

class HomePage extends StatefulWidget {
  const HomePage({super.key});

  @override
  State<HomePage> createState() => _HomePageState();
}

class _HomePageState extends State<HomePage> {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(),
      body: SafeArea(
        child: ListView(
          children: [
            Stack(
              alignment: Alignment.center,
              children: [
                const Padding(
                  padding: EdgeInsets.all(8.0),
                  child: CircleAvatar(
                    radius:
                        85, // Adjust this value to change the size of the CircleAvatar
                  ),
                ),
                Positioned(
                  top: 00, // Adjust this value to position the Image.asset
                  child: Image.asset(
                    'assets/images/wrench.png',
                    height: 180,
                    width: 180,
                  ),
                ),
              ],
            ),
            const SizedBox(
              height: 18,
            ),
            Center(
                child: Text(
              'Crystal Auto Works\nManagement App',
              textAlign: TextAlign.center,
              style:
                  GoogleFonts.inter(fontWeight: FontWeight.w800, fontSize: 28),
            )),
            const SizedBox(
              height: 24,
            ),
            Center(
                child: Text(
              'Apakah kendaraan sudah terdaftar?',
              textAlign: TextAlign.center,
              style: GoogleFonts.inter(
                  fontWeight: FontWeight.w400,
                  fontSize: 16,
                  color: Colors.black54),
            )),
            Padding(
              padding: const EdgeInsets.all(14.0),
              child: Column(
                children: [
                  GestureDetector(
                    onTap: () {
                      Navigator.push(
                          context,
                          MaterialPageRoute(
                              builder: (context) =>
                                  KendaraanSudahTerdaftarPage()));
                    },
                    child: Container(
                      width: double.infinity,
                      height: 200,
                      decoration: BoxDecoration(
                        border:
                            Border.all(color: Colors.grey.shade200, width: 1),
                        color: Colors.green.withOpacity(0.18),
                        borderRadius: BorderRadius.circular(10),
                      ),
                      child: Padding(
                          padding: const EdgeInsets.all(0),
                          child: Row(
                            mainAxisAlignment: MainAxisAlignment.end,
                            crossAxisAlignment: CrossAxisAlignment.center,
                            children: [
                              // const SizedBox(
                              //   width: 20,
                              // ),
                              Image.asset(
                                'assets/images/sudah_terdaftar.png',
                                height: 120,
                                width: 120,
                              ),
                              const SizedBox(
                                width: 20,
                              ),
                              SizedBox(
                                width: MediaQuery.of(context).size.width * 0.5,
                                child: Text('Sudah Terdaftar',
                                    style: GoogleFonts.inter(
                                        color: Colors.green.shade400,
                                        fontWeight: FontWeight.w800,
                                        fontSize: 32)),
                              ),
                              // const SizedBox(
                              //   width: 20,
                              // ),
                            ],
                          )),
                    ),
                  ),
                  const SizedBox(
                      height: 14), // Add some spacing between the buttons
                  GestureDetector(
                    onTap: () {
                      Navigator.push(
                          context,
                          MaterialPageRoute(
                              builder: (context) => KendaraanBelumTerdaftar()));
                    },
                    child: Container(
                      width: double.infinity,
                      height: 200,
                      decoration: BoxDecoration(
                        border:
                            Border.all(color: Colors.grey.shade200, width: 1),
                        color: Colors.red.withOpacity(0.2),
                        borderRadius: BorderRadius.circular(10),
                      ),
                      child: Padding(
                          padding: const EdgeInsets.all(0),
                          child: Row(
                            mainAxisAlignment: MainAxisAlignment.end,
                            crossAxisAlignment: CrossAxisAlignment.center,
                            children: [
                              // const SizedBox(
                              //   width: 20,
                              // ),
                              Image.asset(
                                'assets/images/belum_terdaftar.png',
                                height: 120,
                                width: 120,
                              ),
                              const SizedBox(
                                width: 20,
                              ),
                              SizedBox(
                                width: MediaQuery.of(context).size.width * 0.5,
                                child: Text('Belum Terdaftar',
                                    style: GoogleFonts.inter(
                                        color: Colors.red.shade300,
                                        fontWeight: FontWeight.w800,
                                        fontSize: 32)),
                              ),
                              // const SizedBox(
                              //   width: 20,
                              // ),
                            ],
                          )),
                    ),
                  ),
                ],
              ),
            )
          ],
        ),
      ),
    );
  }
}





input_kendaraan_baru_page.dart
import 'dart:io';
import 'dart:typed_data';

import 'package:bintangban/helper/custom_styles.dart';
import 'package:bintangban/models/data.dart';
import 'package:bintangban/page/export_qr_page.dart';
import 'package:bintangban/services/firestore_services.dart';
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import 'package:fluttertoast/fluttertoast.dart';
import 'package:google_fonts/google_fonts.dart';
import 'package:image_gallery_saver/image_gallery_saver.dart';
import 'package:path_provider/path_provider.dart';
import 'package:qr_flutter/qr_flutter.dart';
import 'package:screenshot/screenshot.dart';
import 'package:share_plus/share_plus.dart';

class KendaraanBelumTerdaftar extends StatefulWidget {
  const KendaraanBelumTerdaftar({super.key});

  @override
  State<KendaraanBelumTerdaftar> createState() =>
      _KendaraanBelumTerdaftarState();
}

class _KendaraanBelumTerdaftarState extends State<KendaraanBelumTerdaftar> {
  late TextEditingController nomorPolisiController;
  late TextEditingController jenisKendaraanController;
  late TextEditingController tipeKendaraanController;
  late TextEditingController namaPemilikController;
  String? _selectedJenisKendaraan;

  // Uint8List _imageFile;

  //Create an instance of ScreenshotController
  late ScreenshotController screenshotController;
  bool isKendaraanTerdaftar = false;
  bool isLoading = false;

  @override
  void initState() {
    super.initState();
    nomorPolisiController = TextEditingController();
    jenisKendaraanController = TextEditingController();
    tipeKendaraanController = TextEditingController();
    namaPemilikController = TextEditingController();
    screenshotController = ScreenshotController();
  }

  @override
  void dispose() {
    // Clean up the controller when the widget is removed from the widget tree
    nomorPolisiController.dispose();
    namaPemilikController.dispose();
    jenisKendaraanController.dispose();
    tipeKendaraanController.dispose();
    super.dispose();
  }

  void setKendaraanTerdaftar() {
    setState(() {
      isKendaraanTerdaftar = true;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Stack(
      children: [
        Scaffold(
            appBar: AppBar(
              title: Text(
                'Input Kendaraan Baru',
                style: CustomStyles.appBarTextStyle(),
              ),
              centerTitle: true,
            ),
            body: SafeArea(
              child: Padding(
                padding: const EdgeInsets.all(28.0),
                child: ListView(
                  children: [
                    Stack(
                      alignment: Alignment.center,
                      children: [
                        const Padding(
                          padding: EdgeInsets.all(14.0),
                          child: CircleAvatar(
                            radius:
                                85, // Adjust this value to change the size of the CircleAvatar
                          ),
                        ),
                        Positioned(
                          top:
                              00, // Adjust this value to position the Image.asset
                          child: Image.asset(
                            'assets/images/form.png',
                            height: 180,
                            width: 180,
                          ),
                        ),
                      ],
                    ),
                    const SizedBox(
                      height: 24,
                    ),
                    Center(
                        child: Text(
                      'Input data untuk mendaftarkan kendaraan baru',
                      textAlign: TextAlign.center,
                      style: GoogleFonts.inter(
                          fontWeight: FontWeight.w400,
                          fontSize: 16,
                          color: Colors.black54),
                    )),
                    TextFormField(
                      controller: nomorPolisiController,
                      onChanged: (text) {
                        nomorPolisiController.value = TextEditingValue(
                          text: text.toUpperCase(),
                          selection: nomorPolisiController.selection,
                        );
                      },
                      decoration: InputDecoration(
                        labelText: 'Nomor Polisi',
                        labelStyle: GoogleFonts.inter(),
                        hintText: 'Contoh: Z1999AR',
                        hintStyle: GoogleFonts.inter(),
                      ),
                    ),
                    DropdownButtonFormField<String>(
                      value: _selectedJenisKendaraan,
                      decoration: const InputDecoration(
                        labelText: 'Jenis Kendaraan',
                      ),
                      items: <String>['Motor', 'Mobil'].map((String value) {
                        return DropdownMenuItem<String>(
                          value: value,
                          child: Text(value),
                        );
                      }).toList(),
                      onChanged: (String? newValue) {
                        // _selectedJenisKendaraan = newValue;
                        jenisKendaraanController.text = newValue ?? '';
                      },
                    ),
                    TextFormField(
                      controller: tipeKendaraanController,
                      decoration: InputDecoration(
                        labelText: 'Tipe Kendaraan',
                        labelStyle: GoogleFonts.inter(),
                        hintText: 'Honda Beat 2013 / Toyota Avanza 2015',
                        hintStyle: GoogleFonts.inter(),
                      ),
                    ),
                    TextFormField(
                      controller: namaPemilikController,
                      decoration: InputDecoration(
                        labelText: 'Nama Pemilik',
                        labelStyle: GoogleFonts.inter(),
                        hintText: 'Contoh: Malik',
                        hintStyle: GoogleFonts.inter(),
                      ),
                    ),
                    const SizedBox(height: 20),
                    ValueListenableBuilder(
                      valueListenable: nomorPolisiController,
                      builder: (context, TextEditingValue nomorPolisiValue, _) {
                        return ValueListenableBuilder(
                          valueListenable: jenisKendaraanController,
                          builder: (context,
                              TextEditingValue jenisKendaraanValue, _) {
                            return ValueListenableBuilder(
                              valueListenable: tipeKendaraanController,
                              builder: (context,
                                  TextEditingValue tipeKendaraanValue, _) {
                                return ValueListenableBuilder(
                                  valueListenable: namaPemilikController,
                                  builder: (context,
                                      TextEditingValue namaPemilikValue, _) {
                                    bool isButtonEnabled = nomorPolisiValue
                                            .text.isNotEmpty &&
                                        jenisKendaraanValue.text.isNotEmpty &&
                                        tipeKendaraanValue.text.isNotEmpty &&
                                        namaPemilikValue.text.isNotEmpty;

                                    return ElevatedButton(
                                      onPressed: isButtonEnabled
                                          ? () async {
                                              setState(() {
                                                isLoading = true;
                                              });
                                              String nomorPolisi =
                                                  nomorPolisiController.text;
                                              String namaPemilik =
                                                  namaPemilikController.text;
                                              String jenisKendaraan =
                                                  jenisKendaraanController.text;
                                              String tipeKendaraan =
                                                  tipeKendaraanController.text;
                                              String url =
                                                  'https://bintangban-56d57.web.app/?nomorPolisi=$nomorPolisi';

                                              // Add the kendaraan with the retrieved values
                                              await FirestoreService
                                                  .addKendaraan(
                                                Kendaraan(
                                                  nomorPolisi: nomorPolisi,
                                                  jenisKendaraan:
                                                      jenisKendaraan,
                                                  tipeKendaraan: tipeKendaraan,
                                                  namaPemilik: namaPemilik,
                                                ),
                                              ).then((value) => value
                                                  ? Navigator.push(context,
                                                      MaterialPageRoute(
                                                          builder: (context) {
                                                      return ExportQRPage(
                                                          url: url);
                                                    }))
                                                  : Fluttertoast.showToast(
                                                          msg:
                                                              'Nopol ${nomorPolisiController.text} sudah terdaftar!',
                                                          toastLength: Toast
                                                              .LENGTH_SHORT,
                                                          gravity: ToastGravity
                                                              .BOTTOM,
                                                          timeInSecForIosWeb: 1,
                                                          fontSize: 16.0)
                                                      .then((value) =>
                                                          setKendaraanTerdaftar()));
                                              setState(() {
                                                isLoading = false;
                                              });
                                            }
                                          : null,
                                      child: Text(
                                        'Simpan',
                                        style: GoogleFonts.inter(
                                            fontWeight: FontWeight.w600),
                                      ),
                                    );
                                  },
                                );
                              },
                            );
                          },
                        );
                      },
                    ),
                    const SizedBox(height: 20),
                    isKendaraanTerdaftar
                        ? Column(
                            children: [
                              Screenshot(
                                controller: screenshotController,
                                child: CrystalQRImage(
                                    nomorPolisiController:
                                        nomorPolisiController),
                              ),
                              ElevatedButton(
                                onPressed: () async {
                                  Fluttertoast.showToast(
                                      msg: 'QR tersimpan di gallery!',
                                      toastLength: Toast.LENGTH_SHORT,
                                      gravity: ToastGravity.BOTTOM,
                                      timeInSecForIosWeb: 1,
                                      fontSize: 16.0);
                                  String name =
                                      'BintangbanQR_${DateTime.now().toIso8601String()}';
                                  // Save img to gallery
                                  await screenshotController
                                      .capture(
                                          delay: Duration(milliseconds: 10))
                                      .then((capturedImage) async {
                                    if (capturedImage != null) {
                                      final directory =
                                          await getApplicationDocumentsDirectory();
                                      final imagePath = await File(
                                              '${directory.path}/image.png')
                                          .create();
                                      await imagePath
                                          .writeAsBytes(capturedImage);

                                      /// Share Plugin
                                      await Share.shareXFiles(
                                        [XFile(imagePath.path)],
                                        text:
                                            'QR Kendaraan ${nomorPolisiController.text}',
                                        subject: 'QR Kendaraan Crystal Autos',
                                      );
                                      // await Share.shareFiles([imagePath.path]);
                                      await ImageGallerySaver.saveImage(
                                          capturedImage,
                                          name: name);
                                    }
                                  }).catchError((onError) {
                                    print(onError);
                                  });
                                },
                                child: const Text('Simpan QR di Galeri'),
                              ),
                            ],
                          )
                        : const SizedBox(),
                  ],
                ),
              ),
            )),
        isLoading
            ? Container(
                color: Colors.black.withOpacity(0.5),
                child: const Center(
                  child: CupertinoActivityIndicator(),
                ),
              )
            : const SizedBox()
      ],
    );
  }
}

class CrystalQRImage extends StatelessWidget {
  const CrystalQRImage({
    super.key,
    required this.nomorPolisiController,
  });

  final TextEditingController nomorPolisiController;

  @override
  Widget build(BuildContext context) {
    return Container(
      color: Colors.white,
      child: Center(
        child: Column(
          children: [
            Text(
              'Crystal Autowork System',
              style: GoogleFonts.inter(
                fontWeight: FontWeight.w600,
                fontSize: 18,
              ),
            ),
            Padding(
              padding: const EdgeInsets.all(8.0),
              child: SizedBox(
                height: 250,
                width: 250,
                child: QrImageView(
                    data:
                        'https://bintangban-56d57.web.app/?nomorPolisi=${nomorPolisiController.text}'),
              ),
            ),
            Text(
              'Scan QR diatas untuk melihat riwayat servis',
              textAlign: TextAlign.center,
              style: GoogleFonts.inter(
                fontWeight: FontWeight.w400,
                fontSize: 16,
              ),
            ),
          ],
        ),
      ),
    );
  }
}

Future<dynamic> ShowCapturedWidget(
    BuildContext context, Uint8List capturedImage) {
  return showDialog(
    useSafeArea: false,
    context: context,
    builder: (context) => Scaffold(
      appBar: AppBar(
        title: Text("Captured widget screenshot"),
      ),
      body: Center(child: Image.memory(capturedImage)),
    ),
  );
}



kendaraan_sudah_terdaftar.dart
import 'package:bintangban/helper/custom_styles.dart';
import 'package:bintangban/page/tentang_kendaraan_page.dart';
import 'package:bintangban/provider/crystal_autos_provider.dart';
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import 'package:fluttertoast/fluttertoast.dart';
import 'package:google_fonts/google_fonts.dart';
import 'package:provider/provider.dart';

class KendaraanSudahTerdaftarPage extends StatefulWidget {
  const KendaraanSudahTerdaftarPage({super.key});

  @override
  State<KendaraanSudahTerdaftarPage> createState() =>
      _KendaraanSudahTerdaftarPageState();
}

class _KendaraanSudahTerdaftarPageState
    extends State<KendaraanSudahTerdaftarPage> {
  late TextEditingController nomorPolisiController;

  @override
  void initState() {
    super.initState();
    nomorPolisiController = TextEditingController();
  }

  @override
  void dispose() {
    // Clean up the controller when the widget is removed from the widget tree
    nomorPolisiController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Consumer<BintangbanProvider>(builder: (context, provider, child) {
      return Stack(
        children: [
          Scaffold(
              appBar: AppBar(
                title: Text(
                  'Cari Kendaraan',
                  style: CustomStyles.appBarTextStyle(),
                ),
                centerTitle: true,
              ),
              body: SafeArea(
                child: Padding(
                  padding: const EdgeInsets.all(28.0),
                  child: ListView(
                    children: [
                      Stack(
                        alignment: Alignment.center,
                        children: [
                          const Padding(
                            padding: EdgeInsets.all(14.0),
                            child: CircleAvatar(
                              radius:
                                  85, // Adjust this value to change the size of the CircleAvatar
                            ),
                          ),
                          Positioned(
                            top:
                                00, // Adjust this value to position the Image.asset
                            child: Image.asset(
                              'assets/images/search.png',
                              height: 180,
                              width: 180,
                            ),
                          ),
                        ],
                      ),
                      const SizedBox(
                        height: 24,
                      ),
                      Center(
                          child: Text(
                        'Masukkan nomor polisi untuk mencari',
                        textAlign: TextAlign.center,
                        style: GoogleFonts.inter(
                            fontWeight: FontWeight.w400,
                            fontSize: 16,
                            color: Colors.black54),
                      )),
                      TextFormField(
                        controller: nomorPolisiController,
                        onChanged: (text) {
                          nomorPolisiController.value = TextEditingValue(
                            text: text.toUpperCase(),
                            selection: nomorPolisiController.selection,
                          );
                        },
                        decoration: InputDecoration(
                          labelText: 'Nomor Polisi',
                          labelStyle: GoogleFonts.inter(),
                          hintText: 'Contoh: Z1999AR',
                          hintStyle: GoogleFonts.inter(),
                        ),
                      ),
                      const SizedBox(height: 20),
                      ValueListenableBuilder<TextEditingValue>(
                        valueListenable: nomorPolisiController,
                        builder: (context, TextEditingValue value, _) {
                          return ElevatedButton(
                            onPressed: value.text.isEmpty
                                ? null
                                : () async {
                                    String nomorPolisi =
                                        value.text.toUpperCase();
                                    var bintangbanProvider =
                                        Provider.of<BintangbanProvider>(
                                            context,
                                            listen: false);
                                    bintangbanProvider
                                        .setNomorPolisi(nomorPolisi);
                                    await bintangbanProvider
                                        .getAllData()
                                        .then((value) => value
                                            ? Navigator.push(
                                                context,
                                                MaterialPageRoute(
                                                    builder: (context) =>
                                                        const TentangKendaraanPage()))
                                            : Fluttertoast.showToast(
                                                msg:
                                                    "$nomorPolisi belum terdaftar! ૮₍ ˃ ⤙ ˂ ₎ა",
                                                toastLength: Toast.LENGTH_SHORT,
                                                gravity: ToastGravity.BOTTOM,
                                              ));
                                  },
                            child: Text(
                              'Cari',
                              style: GoogleFonts.inter(),
                            ),
                          );
                        },
                      ),
                    ],
                  ),
                ),
              )),
          provider.isLoading
              ? Container(
                  color: Colors.black.withOpacity(0.5),
                  child: const Center(
                    child: CupertinoActivityIndicator(),
                  ),
                )
              : const SizedBox()
        ],
      );
    });
  }
}



servis_page.dart
import 'package:bintangban/helper/custom_styles.dart';
import 'package:bintangban/models/data.dart';
import 'package:bintangban/provider/crystal_autos_provider.dart';
import 'package:bintangban/provider/servis_provider.dart';
import 'package:bintangban/services/firestore_services.dart';
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import 'package:fluttertoast/fluttertoast.dart';
import 'package:google_fonts/google_fonts.dart';
import 'package:intl/intl.dart';
import 'package:provider/provider.dart';
import 'package:flutter/services.dart';
import 'package:intl/date_symbol_data_local.dart';

class ServisPage extends StatefulWidget {
  const ServisPage({super.key});

  @override
  State<ServisPage> createState() => _ServisPageState();
}

class _ServisPageState extends State<ServisPage> {
  final catatanServisController = TextEditingController();
  final partServisController = TextEditingController();
  final totalNominalServisController = TextEditingController();
  final statusPaidServisController = TextEditingController();

  final namaItemController = TextEditingController();
  final hargaItemController = TextEditingController();
  final catatanItemController = TextEditingController();
  bool isLoading = false;

  void clearServiceList() {
    var servisProvider = Provider.of<ServisProvider>(context, listen: false);
    servisProvider.clearPartServisList();
  }

  @override
  void initState() {
    super.initState();
    initializeDateFormatting();
  }

  @override
  void dispose() {
    // Clean up the controller when the widget is removed from the widget tree
    catatanServisController.dispose();
    partServisController.dispose();
    totalNominalServisController.dispose();
    statusPaidServisController.dispose();

    namaItemController.dispose();
    hargaItemController.dispose();
    catatanItemController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Stack(
      children: [
        PopScope(
          onPopInvoked: (bool value) {
            clearServiceList();
          },
          child: Scaffold(
            persistentFooterButtons: [
              ValueListenableBuilder(
                valueListenable: catatanServisController,
                builder: (context, TextEditingValue catatanServisValue, _) {
                  return ValueListenableBuilder(
                    valueListenable: totalNominalServisController,
                    builder:
                        (context, TextEditingValue totalNominalServisValue, _) {
                      return ValueListenableBuilder(
                        valueListenable: statusPaidServisController,
                        builder: (context,
                            TextEditingValue statusPaidServisValue, _) {
                          bool isButtonEnabled =
                              catatanServisValue.text.isNotEmpty &&
                                  totalNominalServisValue.text.isNotEmpty &&
                                  statusPaidServisValue.text.isNotEmpty;

                          return ElevatedButton(
                            onPressed: isButtonEnabled
                                ? () async {
                                    setState(() {
                                      isLoading = true;
                                    });
                                    var bintangbanProvider =
                                        Provider.of<BintangbanProvider>(
                                            context,
                                            listen: false);
                                    var servisProvider =
                                        Provider.of<ServisProvider>(context,
                                            listen: false);
                                    FirestoreService.addServis(
                                            Servis(
                                              // idKendaraan: idKendaraanController.text,
                                              tanggalServis: DateTime.now()
                                                  .millisecondsSinceEpoch
                                                  .toString(),
                                              catatanServis:
                                                  catatanServisController.text,
                                              partServis:
                                                  servisProvider.partServisList,
                                              totalNominalServis: double.parse(
                                                  totalNominalServisController
                                                      .text),
                                              statusPaddServis:
                                                  statusPaidServisController
                                                      .text,
                                            ),
                                            bintangbanProvider.nomorPolisi)
                                        .then((value) => value
                                            ? Fluttertoast.showToast(
                                                    msg:
                                                        'Input servis berhasil!',
                                                    toastLength:
                                                        Toast.LENGTH_SHORT,
                                                    gravity:
                                                        ToastGravity.BOTTOM,
                                                    timeInSecForIosWeb: 1,
                                                    fontSize: 16.0)
                                                .then((value) =>
                                                    bintangbanProvider
                                                        .getAllData()
                                                        .then((value) => value
                                                            ? Navigator.pop(
                                                                context)
                                                            : null))
                                            : null);
                                  }
                                : null,
                            child: Center(
                              child: Row(
                                mainAxisAlignment: MainAxisAlignment.center,
                                children: [
                                  Text(
                                    'Kirim Data',
                                    textAlign: TextAlign.center,
                                    style: GoogleFonts.inter(
                                        fontWeight: FontWeight.w600),
                                  ),
                                ],
                              ),
                            ),
                          );
                        },
                      );
                    },
                  );
                },
              ),
            ],
            appBar: AppBar(
              title: Text(
                'Input Servis',
                style: CustomStyles.appBarTextStyle(),
              ),
              centerTitle: true,
            ),
            body: SafeArea(
              child: Padding(
                padding: const EdgeInsets.all(28.0),
                child: ListView(
                  children: [
                    Padding(
                      padding: const EdgeInsets.all(28.0),
                      child: Stack(
                        alignment: Alignment.center,
                        children: [
                          const Padding(
                            padding: EdgeInsets.all(14.0),
                            child: CircleAvatar(
                              radius:
                                  85, // Adjust this value to change the size of the CircleAvatar
                            ),
                          ),
                          Positioned(
                            top:
                                00, // Adjust this value to position the Image.asset
                            child: Image.asset(
                              'assets/images/service.png',
                              height: 180,
                              width: 180,
                            ),
                          ),
                        ],
                      ),
                    ),
                    const SizedBox(
                      height: 24,
                    ),
                    Text(
                      'Tanggal Servis : ${DateFormat('EEEE, dd-MM-yyyy', 'id').format(DateTime.now())}',
                      textAlign: TextAlign.start,
                      style: GoogleFonts.inter(
                          fontWeight: FontWeight.w400,
                          fontSize: 16,
                          color: Colors.black54),
                    ),
                    const SizedBox(
                      height: 28,
                    ),
                    Center(
                        child: Text(
                      'Input data servis',
                      textAlign: TextAlign.center,
                      style: GoogleFonts.inter(
                          fontWeight: FontWeight.w600,
                          fontSize: 18,
                          color: Colors.black87),
                    )),
                    TextField(
                      controller: catatanServisController,
                      decoration: InputDecoration(
                          labelText: 'Catatan Servis',
                          labelStyle: GoogleFonts.inter()),
                    ),
                    TextField(
                      controller: totalNominalServisController,
                      decoration: InputDecoration(
                        labelText: 'Total Nominal Servis',
                        prefix: Text('Rp. ', style: GoogleFonts.inter()),
                        labelStyle: GoogleFonts.inter(),
                      ),
                      keyboardType: TextInputType.number,
                      inputFormatters: <TextInputFormatter>[
                        FilteringTextInputFormatter.allow(
                            RegExp(r'[0-9]')), // Only allow numbers
                      ],
                    ),
                    TextField(
                      controller: statusPaidServisController,
                      decoration: InputDecoration(
                          labelText: 'Status Pembayaran',
                          labelStyle: GoogleFonts.inter()),
                    ),
                    const SizedBox(
                      height: 14,
                    ),
                    const Divider(),
                    const SizedBox(
                      height: 14,
                    ),
                    Text(
                      'Tambah item part servis',
                      style: GoogleFonts.inter(
                          fontWeight: FontWeight.w600, fontSize: 18),
                    ),
                    Padding(
                      padding: const EdgeInsets.fromLTRB(14, 0, 14, 14),
                      child: Column(
                        children: [
                          TextField(
                            controller: namaItemController,
                            decoration: InputDecoration(
                                labelText: 'Nama Item',
                                labelStyle: GoogleFonts.inter()),
                          ),
                          TextField(
                            controller: hargaItemController,
                            decoration: InputDecoration(
                                labelText: 'Harga Item',
                                prefix:
                                    Text('Rp. ', style: GoogleFonts.inter()),
                                labelStyle: GoogleFonts.inter()),
                            keyboardType: TextInputType.number,
                            inputFormatters: <TextInputFormatter>[
                              FilteringTextInputFormatter.allow(
                                  RegExp(r'[0-9]')), // Only allow numbers
                            ],
                          ),
                          TextField(
                            controller: catatanItemController,
                            decoration: InputDecoration(
                                labelText: 'Catatan Item',
                                labelStyle: GoogleFonts.inter()),
                          ),
                        ],
                      ),
                    ),
                    Consumer<ServisProvider>(
                      builder: (context, provider, child) {
                        return ListView.builder(
                          shrinkWrap: true,
                          itemCount: provider.partServisList.length,
                          itemBuilder: (context, index) {
                            PartServis partServis =
                                provider.partServisList[index];
                            return Card(
                              child: ListTile(
                                title: Text(partServis.namaItem),
                                subtitle: Column(
                                  crossAxisAlignment: CrossAxisAlignment.start,
                                  children: [
                                    Text(
                                        'Rp. ${NumberFormatter.formatValueTwo(partServis.hargaItem)}'),
                                    Text('Catatan: ${partServis.catatanItem}'),
                                  ],
                                ),
                                trailing: IconButton(
                                  icon: const Icon(Icons.delete),
                                  onPressed: () {
                                    provider.removePartServisAt(index);
                                  },
                                ),
                              ),
                            );
                          },
                        );
                      },
                    ),
                    // ListView.builder(
                    //   shrinkWrap: true,
                    //   itemCount: partServisList.length,
                    //   itemBuilder: (context, index) {
                    //     PartServis partServis = partServisList[index];
                    //     return Card(
                    //       child: ListTile(
                    //         title: Text(partServis.namaItem),
                    //         subtitle: Column(
                    //           crossAxisAlignment: CrossAxisAlignment.start,
                    //           children: [
                    //             Text('Harga Item: ${partServis.hargaItem.toString()}'),
                    //             Text('Catatan Item: ${partServis.catatanItem}'),
                    //           ],
                    //         ),
                    //       ),
                    //     );
                    //   },
                    // ),
                    ValueListenableBuilder(
                      valueListenable: namaItemController,
                      builder: (context, TextEditingValue namaItemValue, _) {
                        return ValueListenableBuilder(
                          valueListenable: hargaItemController,
                          builder:
                              (context, TextEditingValue hargaItemValue, _) {
                            return ValueListenableBuilder(
                              valueListenable: catatanItemController,
                              builder: (context,
                                  TextEditingValue catatanItemValue, _) {
                                bool isButtonEnabled =
                                    namaItemValue.text.isNotEmpty &&
                                        hargaItemValue.text.isNotEmpty &&
                                        catatanItemValue.text.isNotEmpty;

                                return ElevatedButton(
                                  onPressed: isButtonEnabled
                                      ? () {
                                          var servisProvider =
                                              Provider.of<ServisProvider>(
                                                  context,
                                                  listen: false);
                                          PartServis partServis = PartServis(
                                            namaItem: namaItemController.text,
                                            hargaItem: double.parse(
                                                hargaItemController.text),
                                            catatanItem:
                                                catatanItemController.text,
                                          );

                                          servisProvider
                                              .addPartServis(partServis);
                                          namaItemController.clear();
                                          hargaItemController.clear();
                                          catatanItemController.clear();
                                        }
                                      : null,
                                  child: Text(
                                    'Tambah Part',
                                    style: GoogleFonts.inter(
                                        fontWeight: FontWeight.w600),
                                  ),
                                );
                              },
                            );
                          },
                        );
                      },
                    ),
                  ],
                ),
              ),
            ),
          ),
        ),
        isLoading
            ? Container(
                color: Colors.black.withOpacity(0.5),
                child: const Center(
                  child: CupertinoActivityIndicator(),
                ),
              )
            : const SizedBox()
      ],
    );
  }
}



tentang_kendaraan_page.dart
import 'package:bintangban/helper/custom_styles.dart';
import 'package:bintangban/models/data.dart';
import 'package:bintangban/page/servis_page.dart';
import 'package:bintangban/provider/crystal_autos_provider.dart';
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import 'package:google_fonts/google_fonts.dart';
import 'package:intl/intl.dart';
import 'package:provider/provider.dart';

class TentangKendaraanPage extends StatefulWidget {
  const TentangKendaraanPage({super.key});

  @override
  State<TentangKendaraanPage> createState() => _TentangKendaraanPageState();
}

class _TentangKendaraanPageState extends State<TentangKendaraanPage> {
  @override
  void initState() {
    super.initState();
    WidgetsBinding.instance.addPostFrameCallback((_) {
      _loadData();
    });
  }

  Future<void> _loadData() async {
    var bintangbanProvider =
        Provider.of<BintangbanProvider>(context, listen: false);
    await bintangbanProvider.getAllData();
  }

  @override
  Widget build(BuildContext context) {
    final theme = Theme.of(context).copyWith(dividerColor: Colors.transparent);

    return Scaffold(
      persistentFooterButtons: [
        ElevatedButton(
          onPressed: () {
            Navigator.push(context, MaterialPageRoute(builder: (context) {
              return const ServisPage();
            }));
          },
          child: Row(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              Center(
                  child: Text(
                'Input Servis',
                style: GoogleFonts.inter(fontWeight: FontWeight.w600),
              )),
            ],
          ),
        ),
      ],
      appBar: AppBar(
        title: Text(
          'Tentang Kendaraan',
          style: CustomStyles.appBarTextStyle(),
        ),
        centerTitle: true,
      ),
      body: Consumer<BintangbanProvider>(
        builder: (context, bintangbanProvider, child) {
          // bintangbanProvider.getAllData();
          bool isMotorbike =
              bintangbanProvider.kendaraanPengguna?.jenisKendaraan == 'Motor';
          if (bintangbanProvider.kendaraanPengguna == null)
            return const Center(
              child: CupertinoActivityIndicator(),
            );
          return SafeArea(
            child: ListView(
              children: [
                Padding(
                  padding: const EdgeInsets.all(14.0),
                  child: Stack(
                    alignment: Alignment.center,
                    children: [
                      Padding(
                        padding: const EdgeInsets.all(8.0),
                        child: CircleAvatar(
                          radius:
                              85, // Adjust this value to change the size of the CircleAvatar
                        ),
                      ),
                      Positioned(
                        top:
                            00, // Adjust this value to position the Image.asset
                        child: Image.asset(
                          isMotorbike
                              ? 'assets/images/motorbike.png'
                              : 'assets/images/car.png',
                          height: 180,
                          width: 180,
                        ),
                      ),
                    ],
                  ),
                ),
                Text(
                  '${bintangbanProvider.kendaraanPengguna!.tipeKendaraan}',
                  style: GoogleFonts.inter(
                      fontSize: 28, fontWeight: FontWeight.w700),
                  textAlign: TextAlign.center,
                ),
                Text(
                  '${bintangbanProvider.kendaraanPengguna!.nomorPolisi}',
                  style: GoogleFonts.inter(
                      fontSize: 18, fontWeight: FontWeight.w300),
                  textAlign: TextAlign.center,
                ),
                const SizedBox(
                  height: 8,
                ),
                Text(
                  'a.n ${bintangbanProvider.kendaraanPengguna!.namaPemilik}',
                  style: GoogleFonts.inter(
                      fontSize: 18, fontWeight: FontWeight.w500),
                  textAlign: TextAlign.center,
                ),
                Theme(
                  data: theme,
                  child: ExpansionTile(
                    title: Text(
                      'Riwayat Servis (${bintangbanProvider.listServisPengguna.length})',
                      style: GoogleFonts.inter(fontWeight: FontWeight.w500),
                    ),
                    children: [
                      ListView.builder(
                        shrinkWrap: true,
                        physics: const ClampingScrollPhysics(),
                        itemCount:
                            bintangbanProvider.listServisPengguna.length,
                        itemBuilder: (context, index) {
                          Servis servis =
                              bintangbanProvider.listServisPengguna[index];
                          bool isPartExist = servis.partServis.isNotEmpty;
                          return Padding(
                            padding: const EdgeInsets.fromLTRB(14, 0, 14, 0),
                            child: Card(
                              child: Theme(
                                data: theme,
                                child: ExpansionTile(
                                  title: Text(
                                    '${DateFormat('dd-MM-yyyy').format(DateTime.fromMillisecondsSinceEpoch(int.parse(servis.tanggalServis)))} : ${servis.idServis}',
                                    overflow: TextOverflow.ellipsis,
                                    style: GoogleFonts.inter(
                                        fontWeight: FontWeight.w500,
                                        fontSize: 14),
                                  ),
                                  children: [
                                    const Divider(),
                                    Padding(
                                      padding: const EdgeInsets.all(14.0),
                                      child: Column(
                                        crossAxisAlignment:
                                            CrossAxisAlignment.start,
                                        children: [
                                          Text(
                                            'Catatan: ${servis.catatanServis}',
                                            style: GoogleFonts.inter(
                                                fontWeight: FontWeight.w400),
                                          ),
                                          const SizedBox(
                                            height: 28,
                                          ),
                                          Text(
                                            'TOTAL:',
                                            style: GoogleFonts.inter(
                                                fontWeight: FontWeight.w400),
                                          ),
                                          Row(
                                            mainAxisAlignment:
                                                MainAxisAlignment.spaceBetween,
                                            children: [
                                              Flexible(
                                                child: Text(
                                                  'Rp. ${NumberFormatter.formatValueTwo(servis.totalNominalServis)}',
                                                  style: GoogleFonts.inter(
                                                      fontWeight:
                                                          FontWeight.w700,
                                                      fontSize: 14),
                                                ),
                                              ),
                                              Text(
                                                '${servis.statusPaddServis.toUpperCase()}',
                                                style: GoogleFonts.inter(
                                                    fontWeight: FontWeight.w700,
                                                    fontSize: 14),
                                              ),
                                            ],
                                          ),
                                          const Divider(),
                                          isPartExist
                                              ? ExpansionTile(
                                                  title: Text(
                                                    'Rincian',
                                                    style: GoogleFonts.inter(
                                                        fontWeight:
                                                            FontWeight.w500,
                                                        fontSize: 14),
                                                  ),
                                                  children: [
                                                    Padding(
                                                      padding: const EdgeInsets
                                                          .symmetric(
                                                          horizontal: 14),
                                                      child: ListView.builder(
                                                        shrinkWrap: true,
                                                        itemCount: servis
                                                            .partServis.length,
                                                        itemBuilder:
                                                            (context, index) {
                                                          PartServis
                                                              partServis =
                                                              servis.partServis[
                                                                  index];
                                                          return Column(
                                                            crossAxisAlignment:
                                                                CrossAxisAlignment
                                                                    .start,
                                                            children: [
                                                              Row(
                                                                mainAxisAlignment:
                                                                    MainAxisAlignment
                                                                        .spaceBetween,
                                                                children: [
                                                                  Flexible(
                                                                    child: Text(
                                                                      '${(index + 1).toString()}. ${partServis.namaItem}',
                                                                      style: GoogleFonts.inter(
                                                                          fontWeight:
                                                                              FontWeight.w600),
                                                                    ),
                                                                  ),
                                                                  Flexible(
                                                                    child: Text(
                                                                      'Rp. ${NumberFormatter.formatValueTwo(partServis.hargaItem)}',
                                                                      style: GoogleFonts.inter(
                                                                          fontWeight:
                                                                              FontWeight.w400),
                                                                    ),
                                                                  ),
                                                                ],
                                                              ),
                                                              Text(
                                                                'Catatan: ${partServis.catatanItem}',
                                                                style: GoogleFonts.inter(
                                                                    fontWeight:
                                                                        FontWeight
                                                                            .w400),
                                                              ),
                                                              const Divider()
                                                            ],
                                                          );
                                                        },
                                                      ),
                                                    ),
                                                  ],
                                                )
                                              : const SizedBox(),
                                        ],
                                      ),
                                    ),
                                  ],
                                ),
                              ),
                            ),
                          );
                        },
                      ),
                    ],
                  ),
                ),

                // Container(
                //   height: 200,
                //   child: Consumer<BintangbanProvider>(
                //     builder: (context, provider, child) {
                //       if (provider.kendaraanPengguna == null) {
                //         return const Center(
                //           child: CupertinoActivityIndicator(),
                //         );
                //       } else {
                //         return ListView.builder(
                //           itemCount: provider.listServisPengguna.length,
                //           itemBuilder: (context, index) {
                //             Servis servis = provider.listServisPengguna[index];
                //             return Column(
                //               children: [
                //                 Text('ID Servis: ${servis.idServis}'),
                //                 Text('Tanggal Servis: ${servis.tanggalServis}\n'
                //                     'Catatan Servis: ${servis.catatanServis}\n'
                //                     'Total Nominal Servis: ${servis.totalNominalServis}\n'
                //                     'Status Padd Servis: ${servis.statusPaddServis}'),
                //                 ExpansionTile(
                //                   title: Text('Part yang dibeli'),
                //                   children: [
                //                     SizedBox(
                //                       // height: 200,
                //                       child: ListView.builder(
                //                         shrinkWrap: true,
                //                         itemCount: servis.partServis.length,
                //                         itemBuilder: (context, index) {
                //                           PartServis partServis =
                //                               servis.partServis[index];
                //                           return Column(
                //                             children: [
                //                               Text(
                //                                   'Nama Item: ${partServis.namaItem}'),
                //                               Text(
                //                                   'Harga Item: ${partServis.hargaItem}'),
                //                               Text(
                //                                   'Catatan Item: ${partServis.catatanItem}'),
                //                             ],
                //                           );
                //                         },
                //                       ),
                //                     ),
                //                   ],
                //                 )
                //               ],
                //             );
                //           },
                //         );
                //       }
                //     },
                //   ),
                // )
              ],
            ),
          );
        },
      ),
    );
  }
}



tentang_kendaraan_web_page.dart

import 'package:bintangban/helper/custom_styles.dart';
import 'package:bintangban/models/data.dart';
import 'package:bintangban/provider/web_provider.dart';
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import 'package:google_fonts/google_fonts.dart';
import 'package:intl/intl.dart';
import 'package:provider/provider.dart';

class TentangKendaraanWebPage extends StatefulWidget {
  final String? nomorPolisi;
  const TentangKendaraanWebPage({this.nomorPolisi, super.key});

  @override
  State<TentangKendaraanWebPage> createState() =>
      _TentangKendaraanWebPageState();
}

class _TentangKendaraanWebPageState extends State<TentangKendaraanWebPage> {
  @override
  void initState() {
    super.initState();
    WidgetsBinding.instance.addPostFrameCallback((_) {
      _loadData();
    });
  }

  Future<void> _loadData() async {
    var provider = Provider.of<WebProvider>(context, listen: false);
    await provider.getKendaraanByNomorPolisiWeb(widget.nomorPolisi ?? '');
    await provider.getServisByNomorPolisiWeb(widget.nomorPolisi ?? '');
  }

  @override
  Widget build(BuildContext context) {
    final theme = Theme.of(context).copyWith(dividerColor: Colors.transparent);

    return Scaffold(
      appBar: AppBar(
        title: Text(
          'Tentang Kendaraan',
          style: CustomStyles.appBarTextStyle(),
        ),
        centerTitle: true,
      ),
      body: Consumer<WebProvider>(
        builder: (context, bintangbanProvider, child) {
          // bintangbanProvider.getAllData();
          bool isMotorbike =
              bintangbanProvider.kendaraanPengguna?.jenisKendaraan == 'Motor';
          if (bintangbanProvider.kendaraanPengguna == null)
            return const Center(
              child: CupertinoActivityIndicator(),
            );
          return SafeArea(
            child: ListView(
              children: [
                Padding(
                  padding: const EdgeInsets.all(14.0),
                  child: Stack(
                    alignment: Alignment.center,
                    children: [
                      Padding(
                        padding: const EdgeInsets.all(8.0),
                        child: CircleAvatar(
                          radius:
                              85, // Adjust this value to change the size of the CircleAvatar
                        ),
                      ),
                      Positioned(
                        top:
                            00, // Adjust this value to position the Image.asset
                        child: Image.asset(
                          isMotorbike
                              ? 'assets/images/motorbike.png'
                              : 'assets/images/car.png',
                          height: 180,
                          width: 180,
                        ),
                      ),
                    ],
                  ),
                ),
                Text(
                  '${bintangbanProvider.kendaraanPengguna!.tipeKendaraan}',
                  style: GoogleFonts.inter(
                      fontSize: 28, fontWeight: FontWeight.w700),
                  textAlign: TextAlign.center,
                ),
                Text(
                  '${bintangbanProvider.kendaraanPengguna!.nomorPolisi}',
                  style: GoogleFonts.inter(
                      fontSize: 18, fontWeight: FontWeight.w300),
                  textAlign: TextAlign.center,
                ),
                const SizedBox(
                  height: 8,
                ),
                Text(
                  'a.n ${bintangbanProvider.kendaraanPengguna!.namaPemilik}',
                  style: GoogleFonts.inter(
                      fontSize: 18, fontWeight: FontWeight.w500),
                  textAlign: TextAlign.center,
                ),
                Theme(
                  data: theme,
                  child: ExpansionTile(
                    title: Text(
                      'Riwayat Servis (${bintangbanProvider.listServisPengguna.length})',
                      style: GoogleFonts.inter(fontWeight: FontWeight.w500),
                    ),
                    children: [
                      ListView.builder(
                        shrinkWrap: true,
                        physics: const ClampingScrollPhysics(),
                        itemCount:
                            bintangbanProvider.listServisPengguna.length,
                        itemBuilder: (context, index) {
                          Servis servis =
                              bintangbanProvider.listServisPengguna[index];
                          bool isPartExist = servis.partServis.isNotEmpty;
                          return Padding(
                            padding: const EdgeInsets.fromLTRB(14, 0, 14, 0),
                            child: Card(
                              child: Theme(
                                data: theme,
                                child: ExpansionTile(
                                  title: Text(
                                    '${DateFormat('dd-MM-yyyy').format(DateTime.fromMillisecondsSinceEpoch(int.parse(servis.tanggalServis)))} : ${servis.idServis}',
                                    overflow: TextOverflow.ellipsis,
                                    style: GoogleFonts.inter(
                                        fontWeight: FontWeight.w500,
                                        fontSize: 14),
                                  ),
                                  children: [
                                    const Divider(),
                                    Padding(
                                      padding: const EdgeInsets.all(14.0),
                                      child: Column(
                                        crossAxisAlignment:
                                            CrossAxisAlignment.start,
                                        children: [
                                          Text(
                                            'Catatan: ${servis.catatanServis}',
                                            style: GoogleFonts.inter(
                                                fontWeight: FontWeight.w400),
                                          ),
                                          const SizedBox(
                                            height: 28,
                                          ),
                                          Text(
                                            'TOTAL:',
                                            style: GoogleFonts.inter(
                                                fontWeight: FontWeight.w400),
                                          ),
                                          Row(
                                            mainAxisAlignment:
                                                MainAxisAlignment.spaceBetween,
                                            children: [
                                              Flexible(
                                                child: Text(
                                                  'Rp. ${NumberFormatter.formatValueTwo(servis.totalNominalServis)}',
                                                  style: GoogleFonts.inter(
                                                      fontWeight:
                                                          FontWeight.w700,
                                                      fontSize: 14),
                                                ),
                                              ),
                                              Text(
                                                '${servis.statusPaddServis.toUpperCase()}',
                                                style: GoogleFonts.inter(
                                                    fontWeight: FontWeight.w700,
                                                    fontSize: 14),
                                              ),
                                            ],
                                          ),
                                          const Divider(),
                                          isPartExist
                                              ? ExpansionTile(
                                                  title: Text(
                                                    'Rincian',
                                                    style: GoogleFonts.inter(
                                                        fontWeight:
                                                            FontWeight.w500,
                                                        fontSize: 14),
                                                  ),
                                                  children: [
                                                    Padding(
                                                      padding: const EdgeInsets
                                                          .symmetric(
                                                          horizontal: 14),
                                                      child: ListView.builder(
                                                        shrinkWrap: true,
                                                        itemCount: servis
                                                            .partServis.length,
                                                        itemBuilder:
                                                            (context, index) {
                                                          PartServis
                                                              partServis =
                                                              servis.partServis[
                                                                  index];
                                                          return Column(
                                                            crossAxisAlignment:
                                                                CrossAxisAlignment
                                                                    .start,
                                                            children: [
                                                              Row(
                                                                mainAxisAlignment:
                                                                    MainAxisAlignment
                                                                        .spaceBetween,
                                                                children: [
                                                                  Flexible(
                                                                    child: Text(
                                                                      '${(index + 1).toString()}. ${partServis.namaItem}',
                                                                      style: GoogleFonts.inter(
                                                                          fontWeight:
                                                                              FontWeight.w600),
                                                                    ),
                                                                  ),
                                                                  Flexible(
                                                                    child: Text(
                                                                      'Rp. ${NumberFormatter.formatValueTwo(partServis.hargaItem)}',
                                                                      style: GoogleFonts.inter(
                                                                          fontWeight:
                                                                              FontWeight.w600),
                                                                    ),
                                                                  ),
                                                                ],
                                                              ),
                                                              Text(
                                                                'Catatan: ${partServis.catatanItem}',
                                                                style: GoogleFonts.inter(
                                                                    fontWeight:
                                                                        FontWeight
                                                                            .w400),
                                                              ),
                                                              const Divider()
                                                            ],
                                                          );
                                                        },
                                                      ),
                                                    ),
                                                  ],
                                                )
                                              : const SizedBox(),
                                        ],
                                      ),
                                    ),
                                  ],
                                ),
                              ),
                            ),
                          );
                        },
                      ),
                    ],
                  ),
                ),

                // Container(
                //   height: 200,
                //   child: Consumer<BintangbanProvider>(
                //     builder: (context, provider, child) {
                //       if (provider.kendaraanPengguna == null) {
                //         return const Center(
                //           child: CupertinoActivityIndicator(),
                //         );
                //       } else {
                //         return ListView.builder(
                //           itemCount: provider.listServisPengguna.length,
                //           itemBuilder: (context, index) {
                //             Servis servis = provider.listServisPengguna[index];
                //             return Column(
                //               children: [
                //                 Text('ID Servis: ${servis.idServis}'),
                //                 Text('Tanggal Servis: ${servis.tanggalServis}\n'
                //                     'Catatan Servis: ${servis.catatanServis}\n'
                //                     'Total Nominal Servis: ${servis.totalNominalServis}\n'
                //                     'Status Padd Servis: ${servis.statusPaddServis}'),
                //                 ExpansionTile(
                //                   title: Text('Part yang dibeli'),
                //                   children: [
                //                     SizedBox(
                //                       // height: 200,
                //                       child: ListView.builder(
                //                         shrinkWrap: true,
                //                         itemCount: servis.partServis.length,
                //                         itemBuilder: (context, index) {
                //                           PartServis partServis =
                //                               servis.partServis[index];
                //                           return Column(
                //                             children: [
                //                               Text(
                //                                   'Nama Item: ${partServis.namaItem}'),
                //                               Text(
                //                                   'Harga Item: ${partServis.hargaItem}'),
                //                               Text(
                //                                   'Catatan Item: ${partServis.catatanItem}'),
                //                             ],
                //                           );
                //                         },
                //                       ),
                //                     ),
                //                   ],
                //                 )
                //               ],
                //             );
                //           },
                //         );
                //       }
                //     },
                //   ),
                // )
              ],
            ),
          );
        },
      ),
    );
  }
}
